# üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ Server Security Toolkit

## –†–µ–∑—é–º–µ –ø—Ä–æ–µ–∫—Ç–∞

**Server Security Toolkit** ‚Äî –º–æ–¥—É–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Ubuntu/Debian —Å–µ—Ä–≤–µ—Ä–æ–≤. –ü—Ä–æ–µ–∫—Ç —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω, –∏–º–µ–µ—Ç –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º bash (`set -euo pipefail`)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ù–∞–ª–∏—á–∏–µ —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –í `exec_logged()` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `mktemp` –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∞, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ race conditions.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```bash
stdout_file=$(mktemp)
stderr_file=$(mktemp)
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```bash
stdout_file=$(mktemp /tmp/sst-stdout-XXXXXX)
stderr_file=$(mktemp /tmp/sst-stderr-XXXXXX)
trap "rm -f '$stdout_file' '$stderr_file'" EXIT
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
check_file_permissions() {
    local file="$1"
    if [[ ! -w "$(dirname "$file")" ]]; then
        log_error "–ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ $(dirname "$file")"
        return 1
    fi
}
```

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö SSH –ø–æ—Ä—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö –ø–æ—Ä—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, < 1024 –¥–ª—è –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£—Å–∏–ª–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é:
```bash
validate_ssh_port() {
    local port="$1"
    if [[ ! "$port" =~ ^[0-9]+$ ]] || [[ "$port" -lt 1 ]] || [[ "$port" -gt 65535 ]]; then
        log_error "–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –ø–æ—Ä—Ç: $port"
        return 1
    fi
    if [[ "$port" -lt 1024 ]] && [[ $EUID -ne 0 ]]; then
        log_error "–ü–æ—Ä—Ç—ã < 1024 —Ç—Ä–µ–±—É—é—Ç root –ø—Ä–∞–≤"
        return 1
    fi
    return 0
}
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –º–æ–¥—É–ª—è—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥—É–ª–∏ –Ω–µ –≤—Å–µ–≥–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ `set -euo pipefail`.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –µ–¥–∏–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:
```bash
safe_exec() {
    local desc="$1"
    shift
    local cmd=("$@")
    
    set +e
    "${cmd[@]}"
    local rc=$?
    set -e
    
    if (( rc != 0 )); then
        log_error "–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è '$desc': –∫–æ–¥ $rc"
        return $rc
    fi
    return 0
}
```

### 5. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ –≤ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π –º–æ–¥—É–ª—å —É—Ç–∏–ª–∏—Ç:
```bash
# modules/utils.sh
is_package_installed() {
    local package="$1"
    dpkg -l | grep -q "^ii.*$package" 2>/dev/null
}

install_package() {
    local package="$1"
    if is_package_installed "$package"; then
        log_success "$package —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        return 0
    fi
    
    log_info "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ $package..."
    if apt install -y "$package"; then
        log_success "$package —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        return 0
    else
        log_error "–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ $package"
        return 1
    fi
}
```

### 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–≥–∞—Ö (SSH –∫–ª—é—á–∏, –ø–∞—Ä–æ–ª–∏).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é:
```bash
sanitize_log() {
    local text="$1"
    # –£–¥–∞–ª—è–µ–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    text=$(echo "$text" | sed 's/-----BEGIN.*KEY-----/\[REDACTED KEY\]/g')
    text=$(echo "$text" | sed 's/password[=:][^[:space:]]*/password=\[REDACTED\]/gi')
    echo "$text"
}

log_info_safe() {
    local message="$1"
    log_info "$(sanitize_log "$message")"
}
```

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –≤–µ—Ä—Å–∏–π bash, apt –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```bash
check_bash_version() {
    local required_version="4.0"
    local current_version
    current_version=$(bash --version | head -1 | grep -oE '[0-9]+\.[0-9]+' | head -1)
    
    if ! printf '%s\n%s\n' "$required_version" "$current_version" | sort -V -C; then
        log_error "–¢—Ä–µ–±—É–µ—Ç—Å—è bash >= $required_version, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω $current_version"
        return 1
    fi
    return 0
}
```

### 8. –£–ª—É—á—à–µ–Ω–∏–µ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ñ–∞–π–ª–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `logrotate`:
```bash
setup_logrotate() {
    local logrotate_conf="/etc/logrotate.d/server-security-toolkit"
    cat > "$logrotate_conf" <<EOF
${LOGS_DIR}/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
}
EOF
    log_success "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ logrotate"
}
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 9. –î–æ–±–∞–≤–∏—Ç—å dry-run —Ä–µ–∂–∏–º
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –†–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```bash
DRY_RUN=false

dry_run_exec() {
    local desc="$1"
    shift
    local cmd=("$@")
    
    if [[ "$DRY_RUN" == "true" ]]; then
        log_info "[DRY-RUN] –ë—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${cmd[*]}"
        return 0
    else
        "${cmd[@]}"
    fi
}
```

### 10. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫
**–ü—Ä–æ–±–ª–µ–º–∞:** –í `main.sh` –µ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∞ symlinks, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è:
```bash
get_real_script_path() {
    local script_path="${BASH_SOURCE[0]}"
    while [[ -L "$script_path" ]]; do
        script_path=$(readlink -f "$script_path")
    done
    echo "$(cd "$(dirname "$script_path")" && pwd)/$(basename "$script_path")"
}
```

### 11. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π:
```bash
time_exec() {
    local desc="$1"
    shift
    local start_time
    start_time=$(date +%s.%N)
    
    "$@"
    local rc=$?
    
    local end_time
    end_time=$(date +%s.%N)
    local duration
    duration=$(echo "$end_time - $start_time" | bc)
    
    log_info "–û–ø–µ—Ä–∞—Ü–∏—è '$desc' –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞ ${duration}s"
    return $rc
}
```

### 12. –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** `defaults.env` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```bash
validate_config() {
    local config_file="$1"
    local errors=()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    if [[ -z "${SSH_NEW_PORT:-}" ]]; then
        errors+=("SSH_NEW_PORT –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
    elif ! validate_ssh_port "$SSH_NEW_PORT"; then
        errors+=("SSH_NEW_PORT –∏–º–µ–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: $SSH_NEW_PORT")
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—É–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    for var in SSH_DISABLE_PASSWORD_AUTH SSH_DISABLE_ROOT_LOGIN; do
        if [[ -n "${!var:-}" ]] && [[ "${!var}" != "true" ]] && [[ "${!var}" != "false" ]]; then
            errors+=("$var –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'true' –∏–ª–∏ 'false'")
        fi
    done
    
    if [[ ${#errors[@]} -gt 0 ]]; then
        log_error "–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:"
        for error in "${errors[@]}"; do
            log_error "  - $error"
        done
        return 1
    fi
    
    return 0
}
```

### 13. –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π:
```bash
# tests/unit_tests.sh
test_get_ssh_port() {
    # –¢–µ—Å—Ç 1: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç
    local port
    port=$(get_ssh_port)
    assert_equal "$port" "22" "get_ssh_port –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 22 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
}

test_validate_ssh_port() {
    assert_true "validate_ssh_port 22" "–ü–æ—Ä—Ç 22 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º"
    assert_false "validate_ssh_port 99999" "–ü–æ—Ä—Ç > 65535 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º"
    assert_false "validate_ssh_port abc" "–ù–µ—á–∏—Å–ª–æ–≤–æ–π –ø–æ—Ä—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º"
}
```

### 14. –£–ª—É—á—à–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Ñ—É–Ω–∫—Ü–∏–π
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å JSDoc-–ø–æ–¥–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
```bash
# @brief –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
# @param backup_dir –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–µ–∫–∞–ø–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# @return 0 –ø—Ä–∏ —É—Å–ø–µ—Ö–µ, 1 –ø—Ä–∏ –æ—à–∏–±–∫–µ
# @side_effect –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª –±–µ–∫–∞–ø–∞ —Å timestamp
backup_ssh_config() {
    # ...
}
```

### 15. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –º–æ–¥—É–ª–µ–π
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª–µ–π:
```bash
validate_module() {
    local module="$1"
    local required_functions=("configure_ssh_security" "backup_ssh_config")
    
    for func in "${required_functions[@]}"; do
        if ! grep -q "^${func}()" "$module"; then
            log_error "–ú–æ–¥—É–ª—å $module –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é $func"
            return 1
        fi
    done
    
    return 0
}
```

### 16. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É Ctrl+C
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** Graceful shutdown:
```bash
setup_interrupt_handler() {
    trap 'handle_interrupt' INT TERM
}

handle_interrupt() {
    echo
    log_warning "–ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã..."
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∑–∞–∫—Ä—ã–≤–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
    exit 130
}
```

### 17. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –±–µ–∫–∞–ø–æ–≤:
```bash
check_disk_space() {
    local path="$1"
    local required_mb="${2:-100}"  # 100MB –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    local available_mb
    available_mb=$(df -m "$path" | tail -1 | awk '{print $4}')
    
    if [[ $available_mb -lt $required_mb ]]; then
        log_error "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ: —Ç—Ä–µ–±—É–µ—Ç—Å—è ${required_mb}MB, –¥–æ—Å—Ç—É–ø–Ω–æ ${available_mb}MB"
        return 1
    fi
    
    return 0
}
```

### 18. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ git –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```bash
git_fetch_with_retry() {
    local max_retries=3
    local retry=0
    
    while [[ $retry -lt $max_retries ]]; do
        if git fetch origin main 2>/dev/null; then
            return 0
        fi
        
        ((retry++))
        log_warning "–ü–æ–ø—ã—Ç–∫–∞ $retry/$max_retries –Ω–µ —É–¥–∞–ª–∞—Å—å, –ø–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥..."
        sleep 5
    done
    
    log_error "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ $max_retries –ø–æ–ø—ã—Ç–æ–∫"
    return 1
}
```

### 19. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å diff –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```bash
show_config_diff() {
    local original="$1"
    local modified="$2"
    
    if command -v diff &>/dev/null; then
        echo "–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:"
        diff -u "$original" "$modified" || true
    else
        log_warning "diff –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
    fi
}
```

### 20. –£–ª—É—á—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π:
```bash
check_version_compatibility() {
    local current_version="$1"
    local new_version="$2"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ major –≤–µ—Ä—Å–∏–∏
    local current_major
    current_major=$(echo "$current_version" | cut -d. -f1)
    local new_major
    new_major=$(echo "$new_version" | cut -d. -f1)
    
    if [[ $new_major -gt $current_major ]]; then
        log_warning "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –Ω–æ–≤–æ–π major –≤–µ—Ä—Å–∏–∏. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å CHANGELOG"
        read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/N): " -r
        if [[ ! "$REPLY" =~ ^[Yy]$ ]]; then
            return 1
        fi
    fi
    
    return 0
}
```

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 21. –ö–æ–¥-—Å—Ç–∞–π–ª
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π (snake_case)
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `.editorconfig` –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `shellcheck` –≤ CI/CD

### 22. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `command -v`)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `mapfile` –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–æ–≤ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `get_ssh_port`)

### 23. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ Ubuntu/Debian

### 24. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ README
- –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
- –î–æ–±–∞–≤–∏—Ç—å troubleshooting guide

### 25. CI/CD
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ shellcheck
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `bandit` –¥–ª—è Python, –µ—Å–ª–∏ –±—É–¥–µ—Ç)

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∫—Ä–∏—Ç–∏—á–Ω–æ)
1. ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (#1)
2. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è SSH –ø–æ—Ä—Ç–æ–≤ (#3)
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –º–æ–¥—É–ª—è—Ö (#4)
4. ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–≥–∞—Ö (#6)

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–≤–∞–∂–Ω–æ)
5. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ (#5)
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (#7)
7. –£–ª—É—á—à–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (#12)
8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (#17)

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
9. Dry-run —Ä–µ–∂–∏–º (#9)
10. –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (#11)
11. Unit-—Ç–µ—Å—Ç—ã (#13)
12. –£–ª—É—á—à–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (#14)

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~5000+
- **–ú–æ–¥—É–ª–µ–π:** 6
- **–¢–µ—Å—Ç–æ–≤:** 1 smoke test
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** ~20%
- **Shellcheck warnings:** –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** > 70%
- **Shellcheck warnings:** 0 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π:** 100%
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** 100% –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

1. **shellcheck** - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ bash –∫–æ–¥–∞
2. **bats** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è bash —Å–∫—Ä–∏–ø—Ç–æ–≤
3. **shfmt** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ bash –∫–æ–¥–∞
4. **git hooks** - pre-commit –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Bash Best Practices](https://mywiki.wooledge.org/BashGuide/Practices)
- [ShellCheck Wiki](https://github.com/koalaman/shellcheck/wiki)
- [Google Shell Style Guide](https://google.github.io/styleguide/shellguide.html)

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** $(date +%Y-%m-%d)
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** v1.0
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** AI Code Review

